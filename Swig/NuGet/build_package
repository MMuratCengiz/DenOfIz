#!/usr/bin/env bash
# Cross-platform script to build DenOfIzGraphics NuGet package
# Detects the OS and runs the appropriate script

# Get the directory of this script
SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )"

# Detect OS
case "$(uname -s)" in
    Linux*|Darwin*)
        echo "Detected Unix-like OS, running shell script..."
        exec "$SCRIPT_DIR/build_package.sh"
        ;;
    CYGWIN*|MINGW*|MSYS*)
        echo "Detected Windows environment, running batch script..."
        cmd.exe /c "$SCRIPT_DIR/build_package.bat"
        ;;
    *)
        # Try to run PowerShell script as a fallback
        if command -v pwsh &> /dev/null; then
            echo "Running with PowerShell Core..."
            pwsh -ExecutionPolicy Bypass -File "$SCRIPT_DIR/build_package.ps1"
        elif command -v powershell &> /dev/null; then
            echo "Running with Windows PowerShell..."
            powershell -ExecutionPolicy Bypass -File "$SCRIPT_DIR/build_package.ps1"
        else
            echo "Unknown OS or required script runner not found."
            echo "Please run the appropriate script manually:"
            echo "- Windows: build_package.bat or build_package.ps1"
            echo "- Linux/macOS: build_package.sh"
            exit 1
        fi
        ;;
esac